language: c
sudo: false
addons:
  apt:
    packages:
    - build-essential
    - libtool
#-m32 misses gdbm for 32bit. wrong probe, would need to download it from somewhere

compiler:
  - gcc
  - clang

<<<<<<<
branches:
  except:
    - branch-point
    - /^type/
    - /-v5.22.0$/

=======
os:
  - linux
  - osx

branches:
  except:
    - branch-point
    - /^type/
    - /-v5.22.0$/

>>>>>>>
matrix:
  include:
    - compiler: gcc
      env: CONFIGURE_OPTION='-Duselongdouble -Accflags="-march=native"'
    - compiler: gcc
      env: CONFIGURE_OPTION='-Duselongdouble -DDEBUGGING'
    - compiler: clang
      env: CONFIGURE_OPTION='-DDEBUGGING'
    - compiler: clang
      env: CONFIGURE_OPTION='-Duselongdouble'
<<<<<<<

matrix:
  allow_failures:
    - compiler: gcc
      env: CONFIGURE_OPTION='-Duse64bitall -Dusethreads -DDEBUGGING'
=======
  allow_failures:
    - compiler: gcc
      env: CONFIGURE_OPTION='-Duse64bitall -Dusethreads -DDEBUGGING'
>>>>>>>
    - compiler: clang
      env: CONFIGURE_OPTION='-Duse64bitall -Dusethreads'
    - compiler: gcc
      env: CONFIGURE_OPTION='-Duse64bitall -Dusethreads'

script:
  - ./Configure -des -Dusedevel -Dusecperl -Uversiononly -Dcc=$CC $CONFIGURE_OPTION -Dprefix=$HOME/perl-blead && TEST_JOBS=4 make -s -j4 test_harness && make -s install && $HOME/perl-blead/bin/cperlivp
after_script:
cache:
  apt: true

notifications:
  irc:
    channels:
      - "irc.perl.org#perl11"
    on_success: always
    on_failure: always
    # to enable skip_join, in IRC channel first execute `/mode -n`
    skip_join: true
    template:
      - "%{repository}#%{build_number} (%{branch} - %{commit} : %{author}): %{message} %{build_url}"
