{"version":1,"ops":[{"type":1,"author":{"id":"04135dc995e2fdcd322aaf4268dbf04630a3cc7c"},"timestamp":1458836004,"metadata":{"github-id":"MDU6SXNzdWUxNDMyODk4MTQ=","github-url":"https://github.com/perl11/cperl/issues/115","origin":"github"},"title":"Storable: restricted Storable hashes broken with PERL_PERTURB_KEYS_TOP","message":"The restricted flag seems to be gone after some splits, but does reappear.\nNot repro with cperl proper hashes. Storable does it's own hash creation.\nThe failing test regression came with [perl #73972] http://rt.perl.org/Public/Bug/Display.html?id=73972\nIt describes exactly the same issue.\n\nFixed in perl5 with commit 11b24ae76382137a580b9b75114adee14ec7afd2\nAuthor: Jesse Luehrs doy@tozt.net\nDate:   Tue Jun 26 16:47:51 2012 -0500\n\n```\nfix off-by-one when restoring hashes [perl #73972]\n\nStorable tries to preallocate enough space for all of the elements it's\ngoing to receive, both for efficiency reasons and because reallocation\ntriggers throwing away all of the placeholders in the hash (which are\nused for restricted hashes) if the hash isn't already READONLY, and\nsince Storable rebuilds restricted hashes by first populating all of the\nplaceholders and then setting it READONLY at the end, this would break\nthings.\n\nUnfortunately, it was allocating just slightly less than enough space -\nhashes reallocate when they hit their limit, not when they exceed it,\nand so if you tried to store a restricted hash with a number of keys\nright on the boundary, it would trigger a reallocation and lose all of\nthe allowed keys that it had just stored. This fixes the issue by\nallocating the correct amount of space to ensure that reallocation\ndoesn't happen.\n```\n\nI don't consider that a blocking bug.","files":null}]}