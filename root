{"version":1,"ops":[{"type":1,"author":{"id":"04135dc995e2fdcd322aaf4268dbf04630a3cc7c"},"timestamp":1443434698,"metadata":{"github-id":"MDU6SXNzdWUxMDg2MjYzOTc=","github-url":"https://github.com/perl11/cperl/issues/53","origin":"github"},"title":"revert PL_sv_objcount deletion","message":"See https://github.com/rurban/perl-compiler/issues/214 where we still use it in B::C, but only for DESTROY methods which are known at compile-time.\nAnd run-time added DESTROY method will be skipped.\n\nRationale: The PL_sv_objcount++ in each bless is much cheaper than running global destruction for simple scripts without any blessed objects (disregarding internal IO Filehandle objects). Doing the DESTROY callback on every SV object in `sv_clean_objs` in global destruction is very expensive, one of the most expensive tasks even. Being able to skip it is 10x faster.\n\nRelevant commits:\n\n```\ncommit 8dab3ba5fe05d49fe039bc05012fdab8bc572a5c\nAuthor: Karl Williamson \u003cpublic@khwilliamson.com\u003e\nDate:   Tue Apr 8 18:46:25 2014 -0600\n\n    Remove deprecated 'PL_sv_objcount'\n\n    This was scheduled to be removed in 5.20, but was forgotten.\n\ncommit d7a08570f1b66c1947fbca76061dfa2f85d0ade0\nAuthor: Steffen Mueller \u003csmueller@cpan.org\u003e\nDate:   Thu Feb 28 18:25:19 2013 +0100\n\n    PL_sv_objcount deprecation notice\n\ncommit ddf23d4a1ae98daa8608179f83aad311d03898ef\nAuthor: Steffen Mueller \u003csmueller@cpan.org\u003e\nDate:   Thu Feb 28 18:23:32 2013 +0100\n\n    Prepare PL_sv_objcount removal\n\n    This used to keep track of all objects. At least by now, that is\n    for no particularly good reason. Just because it could avoid a\n    bit of work during global destruction if no objects remained.\n    Let's do less work at run-time instead.\n\n    The interpreter global will remain for one deprecation cycle.\n```","files":null}]}