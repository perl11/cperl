{"version":1,"ops":[{"type":1,"author":{"id":"81b853802ee58295b1b56dc1253b74e7b177b9de"},"timestamp":1442240582,"metadata":{"github-id":"MDU6SXNzdWUxMDYzNTMyNzI=","github-url":"https://github.com/perl11/cperl/issues/35","origin":"github"},"title":"XS DynaLoader isn't loaded on startup, missing from %INC","message":"Empty is success. A message means failure.\n\n```\nC:\\sources\\cperl\u003eperl -e\"require Win32;\"\nCan't locate DynaLoader.pm in @INC (you may need to install the DynaLoader modul\ne) (@INC contains: C:/sources/cperl/lib .) at C:/sources/cperl/lib/Win32.pm line\n 8.\nCompilation failed in require at -e line 1.\n\nC:\\sources\\cperl\u003eperl -e\"glob('*.h')\"\nCan't locate XSLoader.pm in @INC (you may need to install the XSLoader module) (\n@INC contains: C:/sources/cperl/lib .) at C:/sources/cperl/lib/File/Glob.pm line\n 6.\nCompilation failed in require at -e line 1.\nBEGIN failed--compilation aborted at -e line 1.\n\nC:\\sources\\cperl\u003eperl -e\"DynaLoader::boot_DynaLoader(); require Win32;\"\n\nC:\\sources\\cperl\u003eperl -e\"DynaLoader::boot_DynaLoader(); glob('*.h');\"\nCan't locate XSLoader.pm in @INC (you may need to install the XSLoader module) (\n@INC contains: C:/sources/cperl/lib .) at C:/sources/cperl/lib/File/Glob.pm line\n 6.\nCompilation failed in require at -e line 1.\nBEGIN failed--compilation aborted at -e line 1.\n\nC:\\sources\\cperl\u003eperl -e\"BEGIN{ DynaLoader::boot_DynaLoader();} glob('*.h');\"\n\nC:\\sources\\cperl\u003e\n```\n\nNotice perl phase is important for the glob() example.\n\nThe problem is, there is nothing to call boot_DynaLoader sub except by hand.\nThe only reference to XS_DynaLoader_bootstrap is from xs_init which is defined at https://github.com/perl11/cperl/blob/master/win32/perllib.c#L39  and that is a newXS call, not execution of XS_DynaLoader_bootstrap XSUB.\n\n```\n    perl522.dll!xs_init(interpreter * my_perl=0x00383e54)  Line 39 + 0x10   C\n    perl522.dll!S_parse_body(interpreter * my_perl=0x00000056, char * * env=0x00384e00, void (interpreter *)* xsinit=0x280c55c7)  Line 2229 + 0x4   C\n    perl522.dll!perl_parse(interpreter * my_perl=0x00383e54, void (interpreter *)* xsinit=0x280c55c7, int argc=4, char * * argv=0x00383db8, char * * env=0x00384e00)  Line 1627 C\n    perl522.dll!RunPerl(int argc=4, char * * argv=0x01383db8, char * * env=0x00382f10)  Line 251 + 0x10 C\n    perl.exe!mainCRTStartup()  Line 398 + 0xe   C\n    kernel32.dll!_BaseProcessStart@4()  + 0x23  \n```\n\nother cperl perma-XS-.pms are loaded at https://github.com/perl11/cperl/blob/master/perl.c#L2223 in  S_parse_body through boot_core_xsutils but there is alot of stuff disabled in https://github.com/perl11/cperl/blob/master/xsutils.c#L239 since day 1 of the file in https://github.com/perl11/cperl/commit/d328f3ed932fde6383f19eb4c596509eb41fe4b8 \"strict 1.10c as builtin, re-add xsutils.c \". So how is DynaLoader::boot_DynaLoader XSUB called on your build?\n\nWin32 perl has PERL_IS_MINIPERL on every one of miniperl's .o, but on unix perl I think PERL_IS_MINIPERL is much more restricted in use since most of the .o files are used unchanged for linking full perl but I know something on unix perl does use PERL_IS_MINIPERL.\n\nExample of calling DynaLoader::boot_DynaLoader by hand from BEGIN block on my build.\n\n```\n    perl522.dll!dl_boot(interpreter * my_perl=0x280f9038)  Line 151 C\n    perl522.dll!dl_generic_private_init(interpreter * my_perl=0x00000001)  Line 161 + 0x5   C\n    perl522.dll!boot_DynaLoader(interpreter * my_perl=0x00383e74, cv * cv=0x008fcec4)  Line 515 C\n    perl522.dll!Perl_pp_enterxssub(interpreter * my_perl=0x01383e74)  Line 3515 C\n    perl522.dll!Perl_pp_entersub(interpreter * my_perl=0x0090b53c)  Line 3346 + 0x7 C\n    perl522.dll!Perl_runops_standard(interpreter * my_perl=0x00383e74)  Line 41 + 0x4   C\n    perl522.dll!Perl_call_sv(interpreter * my_perl=0x009088d4, sv * sv=0x00908904, volatile long flags=9472244)  Line 2782 + 0xc    C\n    perl522.dll!Perl_call_list(interpreter * my_perl=0x00383e74, long oldscope=2, av * paramList=0x009085a4)  Line 4906 C\n    perl522.dll!S_process_special_blocks(interpreter * my_perl=0x00070023, long floor=39, const char * const fullname=0x0090a35c, gv * const gv=0x009085b4, cv * const cv=0x009085c4)  Line 8957    C\n    perl522.dll!Perl_newATTRSUB_x(interpreter * my_perl=0x01000002, long floor=39, op * o=0x0090b1c0, op * proto=0x00000000, void * attrs=0x28031203, op * block=0x0091215c, char o_is_gv=0)  Line 8885 + 0x11  C\n    perl522.dll!Perl_yyparse(interpreter * my_perl=0x00383e74, int gramtype=9483344)  Line 295 + 0x26   C\n    perl522.dll!S_parse_body(interpreter * my_perl=0x00000001, char * * env=0x00384e20, void (interpreter *)* xsinit=0x280c55c7)  Line 2323 + 0xd   C\n    perl522.dll!perl_parse(interpreter * my_perl=0x00383e74, void (interpreter *)* xsinit=0x280c55c7, int argc=3, char * * argv=0x00383db8, char * * env=0x00384e20)  Line 1627 C\n    perl522.dll!RunPerl(int argc=3, char * * argv=0x01383db8, char * * env=0x00382f10)  Line 251 + 0x10 C\n    perl.exe!mainCRTStartup()  Line 398 + 0xe   C\n    kernel32.dll!_BaseProcessStart@4()  + 0x23  \n```","files":null}]}