{"version":1,"ops":[{"type":1,"author":{"id":"04135dc995e2fdcd322aaf4268dbf04630a3cc7c"},"timestamp":1500618231,"metadata":{"github-id":"MDU6SXNzdWUyNDQ1NzUyMjU=","github-url":"https://github.com/perl11/cperl/issues/322","origin":"github"},"title":"refactor @class::FIELDS and %class::FIELDS into methods","message":"something like a mop would offer.\nthose fields should be class internal not exposed, as their datastructures are bloated if forced to use the perl5 AV or HV.\nuse a temp. `#define OLD_FIELDS_GV 1` for the old storage model and support benchmarks.\n\nThe fields api returns a PADOFFSET into PAD_COMPNAME for compile-time classes, and the PAD (SV) for run-time objects. for runtime we have the 2 oelem/oelemfast PP calls and add some MOP methods.\n\n```\nvoid\t|field_pad_add\t|NN const HV* klass|NN const char* key|I32 klen|PADOFFSET targ\nPADOFFSET|field_search\t|NN const HV* klass|NN const char* key|I32 klen|bool want_pad\nPADOFFSET|field_pad     |NN const HV* klass|NN const char* key|I32 klen\nPADOFFSET|field_index\t|NN const HV* klass|U32 i\nU32\t|numfields\t|NN const HV* klass\n```\n\n\nExternally the cperl **fields** class corresponds to the perl6 **Attribute** class. (*another example of very bad perl6 naming. clashes with perl5, and every other language.*)\n\nThe fields method on a class returns an array of fields (*called AttributeContainer in perl6*)\n\n**class-\u003efields   =\u003e :Array(:fields)**\n\nThe relevant perl6 API is:\n\nTraits (i.e. Flags with perl5 attribute syntax)\n----\n* Trait is default\n* Trait is required\n* trait is DEPRECATED\n\nMethods\n----\n* method name\n* method package\n* method has_accessor\n* method readonly (*but probably name it **const** for consistency*)\n* method type\n* method get_value\n* method set_value\n\nMOP \n----\n(*Routines supplied by role Metamodel::AttributeContainer* =\u003e fields)\n* method add_attribute  (*=\u003e ClassHOW-\u003eadd_field*)\n* method attributes (*=\u003e ClassHOW-\u003efields*)\n* method set_rw (*=\u003e ClassHOW-\u003eset_const*)\n* method rw (*=\u003e ClassHOW-\u003econst*)","files":null}]}