{"version":1,"ops":[{"type":1,"author":{"id":"2061c43c01102efb065766caee8a1ddfe3b31505"},"timestamp":1467870408,"metadata":{"github-id":"MDU6SXNzdWUxNjQyMzQxNjk=","github-url":"https://github.com/perl11/cperl/issues/178","origin":"github"},"title":"recycle eval-string code and data","message":"This is not related to cperl, but p5p don't care about it.\nOriginal bug posted by bulk88 here: https://rt.perl.org/Public/Bug/Display.html?id=121274\n\nI've rewrite test script to show dramatic memory leak:\n\n```\nlog_mem_usage(\"start\");\n\nfor(1..20) {\n    eval 'sub create_big_array' . $_ . ' {\n        my @big_array;\n        push @big_array, $_ for 1 .. 10_000_000;\n        return;\n    }';\n\n    \"create_big_array$_\"-\u003e();\n\n    log_mem_usage(\"after $_\");\n}\n\nsub log_mem_usage {\n    warn $_[0], \" \", `ps -p $$ -o vsz,rss`;\n}\n```\n\noutput(looks similar for perl-5.8.9 and cperl-5.24):\n\n```\nstart      VSZ    RSS\n 2445916   1792\nafter 1      VSZ    RSS\n 3049324 386004\nafter 2      VSZ    RSS\n 3140652 465880\nafter 3      VSZ    RSS\n 3223364 546640\nafter 4      VSZ    RSS\n 3302460 625896\nafter 5      VSZ    RSS\n 3376936 702688\nafter 6      VSZ    RSS\n 3440840 785880\nafter 7      VSZ    RSS\n 3542144 853908\nafter 8      VSZ    RSS\n 3622140 861712\nafter 9      VSZ    RSS\n 3701856 830184\nafter 10      VSZ    RSS\n 3776332 731268\nafter 11      VSZ    RSS\n 3839864 786372\nafter 12      VSZ    RSS\n 3941564 829184\nafter 13      VSZ    RSS\n 4021280 810856\nafter 14      VSZ    RSS\n 4095756 847128\nafter 15      VSZ    RSS\n 4159288 905216\nafter 16      VSZ    RSS\n 4260988 910256\nafter 17      VSZ    RSS\n 4340704 913028\nafter 18      VSZ    RSS\n 4415180 929988\nafter 19      VSZ    RSS\n 4478712 968668\nafter 20      VSZ    RSS\n 4580412 1055332\n```\n\nactualy it is not related to arrays:\n\n```\n    eval 'sub create_big_array' . $_ . ' {\n        my $s = \"x\" x 100000000;\n        return;\n    }';\n```\n\ncause same leak","files":null}]}