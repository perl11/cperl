{"version":1,"ops":[{"type":1,"author":{"id":"49fa1bdd0592a1c3a29b58e4f3bcd7a09352d674"},"timestamp":1553001307,"metadata":{"github-id":"MDU6SXNzdWU0MjI3MjUyNzg=","github-url":"https://github.com/perl11/cperl/issues/395","origin":"github"},"title":"signature return value in list aligned","message":"Return value for variable in list from signature function is wrong aligned by 8 bits left\n\nThe code was taken from an asn1 decoder library, the code in both functions are the same except the way function arguments are initiated:\n```\nuse strict;\nmy $buf = pack(\"CCC\",0x5f,0x81,0x3a);\n\nmy ($pos, $etag, $id) = decode_tl(0, $buf);\nprintf unpack(\"H*\", $etag).\" id =\u003e $id\\n\";\n\nmy ($pos, $etag, $id) = decode_tl_signature(0, $buf);\nprintf unpack(\"H*\", $etag).\" id =\u003e $id\";\n\n$id \u003e\u003e=8;\nprintf \", shifted id =\u003e $id\\n\";\n\nsub decode_tl {\n    my ($pos) = @_;\n\n    my $etag = substr($_[-1], $pos++, 1);\n\n    my $tag = ord($etag);\n    my $id = $tag \u0026 0x1f;\n\n    if($id == 0x1f) {\n        my $b;\n        my $n=1;\n        $id = 0;\n        do {\n            $tag = substr($_[-1], $pos++, 1);\n            $etag .= $tag;\n            $b = ord substr($tag,-1);\n            $id = ($id \u003c\u003c 7) + ($b \u0026 0x7f);\n        }\n        while($b \u0026 0x80);\n    }\n\n    return ($pos, $etag, $id);\n}\n\nsub decode_tl_signature ($pos, \\$buf) {\n\n    my $etag = substr($buf, $pos++, 1);\n\n    my $tag = ord($etag);\n    my $id = $tag \u0026 0x1f;\n\n    if($id == 0x1f) {\n        my $b;\n        my $n=1;\n        $id = 0;\n        do {\n            $tag = substr($buf, $pos++, 1);\n            $etag .= $tag;\n            $b = ord substr($tag,-1);\n            $id = ($id \u003c\u003c 7) + ($b \u0026 0x7f);\n        }\n        while($b \u0026 0x80);\n    }\n\n    return ($pos, $etag, $id);\n}\n\n```\n/opt/cperl-5.28.2/bin/cperl ./test_signature.pl\n5f813a id =\u003e 186\n5f813a id =\u003e 47616, shifted id =\u003e 186\n\nThe same for cperl 5.24.4, 5.26.5.\nPerl 5.26.1 has no issue.\nIf variable $etag remove from return list than value in variable id is ok.","files":null}]}