{"version":1,"ops":[{"type":1,"author":{"id":"04135dc995e2fdcd322aaf4268dbf04630a3cc7c"},"timestamp":1448696990,"metadata":{"github-id":"MDU6SXNzdWUxMTkyNzkwNDQ=","github-url":"https://github.com/perl11/cperl/issues/75","origin":"github"},"title":"block_end broke newPROG + ByteLoader","message":"Previously a single `;` caused only a STUB optree.\nNow with the changed `block_end()` code with 34b549515 for [perl #77452] it is always a LINESEQ with a STUB as kid.\nThis broke the logic in `newPROG`\n\n```\nif (o-\u003eop_type == OP_STUB) {\n        PL_comppad_name = 0;\n        PL_compcv = 0;\n        S_op_destroy(aTHX_ o);\n        return;\n}\n```\n\nSo compcv will not be reset, thus a source filter (ByteLoader) which sets main_cv and main_start but leaves no optree will be overwritten by an empty main_cv caused by a forced `;` at the end of each source filter.\n\nThis broke ByteLoader, the bytecode compiler with 5.22.\n\nSee https://github.com/rurban/App-perlall/commit/4907abb6dfa86bc5d2572d523e75462a18705aec for the external patch in App::perlall","files":null}]}