{"version":1,"ops":[{"type":1,"author":{"id":"04135dc995e2fdcd322aaf4268dbf04630a3cc7c"},"timestamp":1450650257,"metadata":{"github-id":"MDU6SXNzdWUxMjMxODY2NDI=","github-url":"https://github.com/perl11/cperl/issues/94","origin":"github"},"title":"new sub and signature parser leak on errors","message":"`PERL_DESTRUCT_LEVEL=2 valgrind --leak-check=full ./miniperl -Ilib -e'+sub:a{}'`\n\nWith GH #7 , the interim signature parse leaks the lex op `yyval.opval` on errors.\n\n```\n==10628== 222,208 (7,168 direct, 215,040 indirect) bytes in 14 blocks are definitely lost in loss re\ncord 43 of 43\n==10628==    at 0x4C2AD10: calloc (vg_replace_malloc.c:623)\n==10628==    by 0x415CE1: S_new_slab (op.c:181)\n==10628==    by 0x415DED: Perl_Slab_Alloc (op.c:226)\n==10628==    by 0x4239A1: Perl_newOP (op.c:4748)\n==10628==    by 0x4A0FED: S_pending_ident (toke.c:8257)\n==10628==    by 0x486A02: Perl_yylex (toke.c:4340)\n==10628==    by 0x4B4F04: Perl_yyparse (perly.c:322)\n==10628==    by 0x63CAD9: S_doeval (pp_ctl.c:3484)\n==10628==    by 0x642B49: Perl_pp_require (pp_ctl.c:4169)\n==10628==    by 0x52BB2B: Perl_runops_debug (dump.c:2232)\n==10628==    by 0x40B4D4: Perl_call_sv (perl.c:2740)\n==10628==    by 0x414117: Perl_call_list (perl.c:4846)\n```\n\ntestcase: `cperl t/op/svleak.t`\n\n```\nnot ok 130 - OP_SIGNATURE\n# Failed test 130 - OP_SIGNATURE at t/op/svleak.t line 32\n#      got \"1\"\n# expected \u003c= \"0\"\nnot ok 131 - OP_SIGNATURE err\n# Failed test 131 - OP_SIGNATURE err at t/op/svleak.t line 32\n#      got \"1\"\n# expected \u003c= \"0\"\n```\n\nThis only fails in the errorcase.","files":null}]}