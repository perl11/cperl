{"version":1,"ops":[{"type":1,"author":{"id":"04135dc995e2fdcd322aaf4268dbf04630a3cc7c"},"timestamp":1480361020,"metadata":{"github-id":"MDU6SXNzdWUxOTIwOTQ0MTE=","github-url":"https://github.com/perl11/cperl/issues/227","origin":"github"},"title":"add c++ test, embeddabilty","message":"perl.h, EXTERN.h and XSUB.h needs to be embeddable into C++ projects.\nadd a test `t/porting/embedcpp.t` and try to find a C++ compiler on the system to compile\n\n```\n#include \"EXTERN.h\"\n#include \"perl.h\"\n#include \"XSUB.h\"\n\n#include \u003ciostream\u003e\nusing namespace std;\nint main() {\n  cout \u003c\u003c \"ok 1 - from c++\\n\";\n  return 0;\n}\n``` \n\nvia `$CXX -c -I.. -Wall tmp.cc`.\n\n# findings\n\n## darwin\ndarwin clashes with our do_open, do_close macros in their iostream _OutputIterator.\nSame on freebsd\n```\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../include/c++/v1/locale:3663:21: error: too few arguments provided to function-like macro invocation\n        do_close(__c);\n                    ^\n../embed.h:125:9: note: macro 'do_close' defined here\n#define do_close(a,b)           Perl_do_close(aTHX_ a,b)\n```\n\n```\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../include/c++/v1/locale:3672:69: error: too few arguments provided to function-like macro invocation\n    virtual catalog do_open(const basic_string\u003cchar\u003e\u0026, const locale\u0026) const;\n                                                                    ^\n../perl.h:6934:9: note: macro 'do_open' defined here\n#define do_open(g, n, l, a, rm, rp, sf)\n```\n\nundefine them when used with darwin /usr/bin/c++\nrename them to be used with a mandatory Perl_ prefix. \nnote that do_open is a mathom API and needs to be deprecated.\nused in lib/ExtUtils/typemap, dist/Time-HiRes/typemap, dist/IO/IO.xs\n\n## msvc\n\n[00:08:00] # c:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\VC\\INCLUDE\\limits(378) : error C2766: explicit specialization; 'std::numeric_limits\u003cchar\u003e' has already been defined\n[00:08:00] #         c:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\VC\\INCLUDE\\limits(187) : see previous definition of 'numeric_limits\u003cchar\u003e'\n[00:08:00] # c:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\VC\\INCLUDE\\xtr1common(244) : error C2766: explicit specialization; 'std::tr1::_Is_integral\u003cchar\u003e' has already been defined\n[00:08:00] #         c:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\VC\\INCLUDE\\xtr1common(236) : see previous definition of '_Is_integral\u003cchar\u003e'\n\n[00:08:00] # c:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\VC\\INCLUDE\\ostream(545) : warning C4003: not enough actual parameters for macro 'write'\n[00:08:00] # c:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\VC\\INCLUDE\\ostream(544) : error C2059: syntax error : ')'\n[00:08:00] #         c:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\VC\\INCLUDE\\ostream(604) : see reference to class template instantiation 'std::basic_ostream\u003c_Elem,_Traits\u003e' being compiled\n[00:08:00] # c:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\VC\\INCLUDE\\ostream(546) : error C2143: syntax error : missing ')' before '{'\n\n@bulk88 can you check these errors? My win32 vm's just got bonkers with a new debian update and apparmor nonsense.","files":null}]}