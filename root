{"version":1,"ops":[{"type":1,"author":{"id":"04135dc995e2fdcd322aaf4268dbf04630a3cc7c"},"timestamp":1449827704,"metadata":{"github-id":"MDU6SXNzdWUxMjE2NzQ4OTI=","github-url":"https://github.com/perl11/cperl/issues/85","origin":"github"},"title":"stashcache: off-by-one","message":"This fixes a heap corruption crash with VC 2013 32b in `cpan/ExtUtils-MakeMaker/t/xs.t`\nsee branch `smoke/fix_heap_corruption_visual_c`\n\n```\n--- gv.c\n+++ gv.c\n@@ -1416,7 +1416,6 @@ S_gv_stashpvn_internal(pTHX_ const char *name, U32 namelen, I32 flags)\n     Copy(name, tmpbuf, namelen, char);\n     tmpbuf[namelen]   = ':';\n     tmpbuf[namelen+1] = ':';\n-    tmpbuf[namelen+2] = '\\0';\n     tmpgv = gv_fetchpvn_flags(tmpbuf, tmplen, flags, SVt_PVHV);\n     if (tmpbuf != smallbuf)\n        Safefree(tmpbuf);\n```\n\nbefore on win32:\n\n```\n../cpan/Time-Piece/t/02core_dst.t                               (Wstat: 512 Tests: 60 Failed: 2)\n  Failed tests:  55-56\n  Non-zero exit status: 2\n../dist/Math-BigRat/t/biglog.t                                  (Wstat: 1280 Tests: 9 Failed: 0)\n  Out of memory!\n  Non-zero exit status: 5\n  Parse errors: Bad plan.  You planned 17 tests but ran 9.\n../dist/threads-shared/t/waithires.t                            (Wstat: 256 Tests: 12 Failed: 0)\n  Non-zero exit status: 1\n  Parse errors: Bad plan.  You planned 63 tests but ran 12.\nFiles=2396, Tests=704010, 1541 wallclock secs (93.34 usr +  4.05 sys = 97.39 CPU)\nResult: FAIL\n```\n\nreverted:\n\n```\n../cpan/Time-Piece/t/02core_dst.t                               (Wstat: 512 Tests: 60 Failed: 2)\n  Failed tests:  55-56\n  Non-zero exit status: 2\n../dist/threads-shared/t/waithires.t                            (Wstat: 256 Tests: 12 Failed: 0)\n  Non-zero exit status: 1\n  Parse errors: Bad plan.  You planned 63 tests but ran 12.\n```","files":null}]}