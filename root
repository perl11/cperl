{"version":1,"ops":[{"type":1,"author":{"id":"04135dc995e2fdcd322aaf4268dbf04630a3cc7c"},"timestamp":1483870387,"metadata":{"github-id":"MDU6SXNzdWUxOTk0MTQwMDQ=","github-url":"https://github.com/perl11/cperl/issues/240","origin":"github"},"title":"more dtrace probes: glob, hash","message":"for internal profiling: glob, hash (entry+return)\n\nglob-mode\n```\n       0: gv_init\n       1: gv_add\n       2: gv_fetch\n       3: gv_fetchmeth\n```\n(autoload?, stash?)\n\nhash-mode \n```\n       0: hv_fetch\n       1: hv_store\n       2: hv_exists\n       3: hv_delete\n```\n(magical?)\n\n# glob\n\n - sudo dtrace -qn \"BEGIN{self-\u003ets=0}glob-entry{self-\u003ets=timestamp}glob-return{ts=timestamp-self-\u003ets;@a[arg0]=avg(ts);@q[arg0]=quantize(ts);@c[arg0]=count()}\" -c\"./miniperl -Ilib autodoc.pl\"\n\naverage time per mode (ns):\n\n                1             1234  # ADD\n                0             1417  # INIT\n                2             3055  # FETCH\n                3             4150  # FETCHMETH\n\ntime spent per mode (ns):\n\n                3\n           value  ------------- Distribution ------------- count\n            1024 |                                         0\n            2048 |@@@@@@@@@@@@@                            1\n            4096 |@@@@@@@@@@@@@@@@@@@@@@@@@@@              2\n            8192 |                                         0\n\n                1\n           value  ------------- Distribution ------------- count\n             256 |                                         0\n             512 |@@@@@@@@@@@@@@@@@@@@@@@@@                67\n            1024 |@@@@@@@@@@@                              31\n            2048 |@@@                                      8\n            4096 |@                                        2\n            8192 |                                         0\n\n                0\n           value  ------------- Distribution ------------- count\n             256 |                                         0\n             512 |@                                        8\n            1024 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     273\n            2048 |@@                                       16\n            4096 |                                         3\n            8192 |                                         0\n\n                2\n           value  ------------- Distribution ------------- count\n            1024 |                                         0\n            2048 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    224\n            4096 |@@                                       13\n            8192 |                                         3\n           16384 |                                         1\n           32768 |                                         0\n\nsum of glob calls:\n\n                3                3  # FETCHMETH\n                1              108  # ADD\n                2              241  # FETCH\n                0              300  # INIT\n\n# hash\n\nsum of hash calls:\n\n - sudo dtrace -n \"hash-entry{@[arg0]=count()}\" -c\"./miniperl -Ilib script.pl\"\n\n                3               15  # DELETE\n                2               39  # EXISTS\n                1              125  # STORE\n                0              724  # FETCH\n\nTime spent (on average):\n\n - sudo dtrace -qn \"BEGIN{self-\u003ets=0}hash-entry{self-\u003ets=timestamp}hash-return{@[arg0]=avg(timestamp-self-\u003ets)}\" -c\"./miniperl -Ilib script.pl\"\n\n                0             1000  # FETCH\n                2             1014  # EXISTS\n                1             1111  # STORE\n                3             1641  # DELETE","files":null}]}